.guest-list-nav-tabs

  %ul.nav.nav-pills

    %li
      = link_to guest_lists_path do
        %i.icon-arrow-left
        back to all lists

    %li.active

      = link_to guest_list_path(@guest_list) do
        = @guest_list.owner.full_name
        \:
        = best_in_place @guest_list, :date,
          display_as: :friendly_date, activator: '.edit-date'
        - if @guest_list.pending?
          %span.label-warning.label pending approval
        - elsif @guest_list.approved?
          %span.label-success.label approved
          -# TODO approved by user

    - if can?(:manage, @guest_list)
      %li
        %a.edit-date(href='#') edit the date

- if @guest_list.pending?
  .alert
    %strong HEY!
    this list will not be available at the door until approved

.row-fluid
  .span6

    #guest-list-table
      %table.table.hero-unit

        %thead
          %th name
          %th plus
          %th
            %i.icon-check
            checked-in!

        %tbody
          - @guest_list.invitations.each do |i|
            %tr.invitation{ class: ('redeemed' if i.redeemed) }
              %td.name
                %p
                  = link_to i.guest do
                    = i.guest.full_name
              %td
                = simple_form_for(i, remote: true) do |f|
                  = f.input :plus, as: :select, collection: (0..100).to_a.reverse,
                    label: false

              %td
                = simple_form_for(i, remote: true) do |f|
                  = f.input :redeemed, label: false, class: 'checkable'

%hr
#guest-list-stats
  .row-fluid
    .span3
      %small
        %dl
          %dt
            distribution
          %dd
            #{@guest_list.pct_female}% female

:coffeescript
  jQuery ->
    # submit form to update invitation redemption status
    # when checkbox is changed
    $selectPlus = $('.select')
    $checkboxRedeemed = $('.boolean')

    $selectPlus.live('change', ->
      $(this).parents('form:first').submit()
    )
    $checkboxRedeemed.live('change', ->
      $(this).parents('form:first').submit()
    )

