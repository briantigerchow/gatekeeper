#guests-index
  = render 'tabs'

  .row-fluid
    %table.table
      %thead
        %th name
        %th
          approved lists/invitations
          = surround '(', ')' do
            = Date.yesterday.strftime('%A %e %B')
            onward
      - @guests.each do |guest|
        %tbody
          %tr
            %td
              %p
                .guest-name
                  = link_to guest do
                    = guest.full_name
                  - if can? :view_rating, guest
                    = stars(guest.rating)

            %td.lists-and-invitations
              -# NB: limit the scope to the permitted lists as early in chain as possible
              - lists = guest.guest_lists.active.accessible_by(current_ability)
              - if lists.empty?
                not on any lists
              - else
                -# COLLAPSING ELEMENTS
                %div.collapsed-fields(data-collapse)
                  %a
                    show/hide
                    = pluralize lists.count, 'list'
                  .collapsed-field-contents
                    = render '/guest_lists/list_by_date', guest_lists: lists


= content_for :javascript do
  :coffeescript
    jQuery ->
      $('.collapsed-fields').collapse()
